@model CustomerModel.ChangePasswordModel

@{
    async Task RenderForm()
    {
        @*Display all errors line by line instead of just the first one.*@
        <div asp-validation-summary="All"></div>
        <div>
            <form>
                <editor asp-for="Password"
                        placeholder="@T("Account.ChangePassword.Fields.NewPassword")"
                        title="@T("Admin.Customers.Customers.Fields.Password.Hint")" />
            </form>
        </div>
    }

    if ((ViewBag.ShowFormOnly as bool?) ?? false)
    {
        await RenderForm();
        return;
    }
}

<modal id="change-password-dialog" sm-render-at-page-end="true" sm-size="Medium">
    <modal-header sm-title="@T("Account.ChangePassword")"></modal-header>
    <modal-body>
        @{ await RenderForm(); }
    </modal-body>
    <modal-footer>
        <button class="btn btn-secondary btn-flat" data-dismiss="modal" aria-hidden="true">
            <span>@T("Common.Cancel")</span>
        </button>
        <button id="btnChangePassword" type="button" class="btn btn-secondary btn-to-danger">
            <span>@T("Account.ChangePassword")</span>
        </button>
    </modal-footer>
</modal>

<script sm-target-zone="scripts" data-origin="change-password">
    $(function () {
        $('#btnChangePassword').on('click', function (e) {
            e.preventDefault();

            var dialog = $('#change-password-dialog');
            $.ajax({
				cache: false,
				type: 'POST',
				url: '@(Url.Action("ChangePassword", "Customer", new { id = Model.Id }))',
                data: dialog.find('form:first').serialize(),
                success: function (response) {
                    if (_.isEmpty(response)) {
                        dialog.modal('hide');
                        displayNotification(@T("Admin.Customers.Customers.PasswordChanged").JsValue, 'success');
                    }
                    else {
                        dialog.find('.modal-body').first().html(response);
                    }
                },
                error: function (objXml) {
                    if (objXml != null && objXml.responseText != null && objXml.responseText !== '') {
                        displayNotification(objXml.responseText, 'error');
                    }
                }
            });

            return false;
        });
    });
</script>