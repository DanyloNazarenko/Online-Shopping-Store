@model ProductModel.ProductVariantAttributeValueListModel

@{
    Assets.BodyAttributes.AppendCssClass("spa-layout");

    ViewBag.Title = T(Model.IsListTypeAttribute ? "Admin.Catalog.Products.ProductVariantAttributes.OptionsAndRulesForProduct" : "Admin.Catalog.Products.ProductVariantAttributes.RulesForProduct",
        Model.ProductVariantAttributeName,
        Model.ProductName);

    var gridViewData = new ViewDataDictionary(this.ViewData);
    gridViewData["Parent"] = Model;

    var attributes = ViewBag.ProductVariantAttributes as List<ExtendedSelectListItem>;
    var selectedAttribute = attributes.FirstOrDefault(x => x.Selected);

    // TODO: (mg) Too wide title section. The new dropdown button displays the attr name already. No need to display in page title also.
    //       Suggestion: Edit attribute. Product: <span class="fs-h6 text-muted">{Name}</span>
}

<form asp-action="EditAttributeValues" id="productvariantattribute-form">
    <input type="hidden" asp-for="ProductVariantAttributeId" />
    <input type="hidden" asp-for="RawRuleData" />

    <div class="section-header">
        <div class="title">
            <div class="btn-group mr-3" role="group">
                <a sm-backto asp-action="Edit" asp-controller="Product" asp-route-Id="@Model.ProductId"
                   style="margin: 0 !important;"
                   title="@T("Admin.Catalog.Products.ProductVariantAttributes.Attributes.Values.BackToProduct")"></a>
                <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle text-truncate"
                        style="max-width: 15vw"
                        data-toggle="dropdown"
                        aria-haspopup="true"
                        aria-expanded="true"
                        data-boundary="window"
                        title="@selectedAttribute?.Text">
                    <span class="d-none d-md-inline text-truncate">@selectedAttribute?.Text</span>
                </button>
                <div class="dropdown-menu">
                    @foreach (var item in attributes)
                    {
                        <a href="@Url.Action("EditAttributeValues", new { productVariantAttributeId = item.Value })"
                           title="@(item.Get<string>("LinkTitle"))"
                           style="line-height: var(--body-line-height)"
                           class="dropdown-item@(item.Disabled ? " disabled" : string.Empty)">
                            <span>@item.Text</span>
                        </a>
                    }
                </div>
            </div>
            <span>@ViewBag.Title</span>
        </div>
        <div class="options">
            <button type="submit" name="save" value="save" class="btn btn-warning">
                <i class="fa fa-check"></i>
                <span>@T("Admin.Common.Save")</span>
            </button>
            <button type="submit" name="save" value="save-continue" class="btn btn-secondary">
                <span>@T("Admin.Common.SaveContinue")</span>
            </button>
        </div>
    </div>
</form>

@if (Model.IsListTypeAttribute)
{
    <tabstrip id="productvariantattribute-edit" sm-nav-style="Material" sm-nav-position="Top">
        <tab sm-title="@T("Admin.Catalog.Products.ProductVariantAttributes.Attributes.Values")" sm-selected="true" sm-adaptive-height="true">
            <partial name="Grids/_Grid.AttributeValues" model="null" view-data="gridViewData" />
        </tab>
        <tab sm-title="@T("Admin.Catalog.Products.ProductVariantAttributes.Rules")">
            <partial name="Partials/_ProductVariantAttributeRules" />
        </tab>
    </tabstrip>
}
else
{
    <partial name="Partials/_ProductVariantAttributeRules" />
}